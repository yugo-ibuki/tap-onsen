# voice-input-app TODO

## チーム構成と担当領域

```
                    ┌─────────────────────┐
                    │  Team A: Foundation  │ ← 全チームの前提
                    │  (基盤・型定義・設定)  │
                    └──────────┬──────────┘
                               │
            ┌──────────────────┼──────────────────┐
            │                  │                  │
   ┌────────▼────────┐ ┌──────▼───────┐ ┌────────▼────────┐
   │  Team B: Frontend│ │ Team C: Rust │ │                 │
   │  (UI コンポーネント)│ │  Backend     │ │  (統合フェーズで  │
   │                  │ │ (Tauriコマンド)│ │   全チーム合流)   │
   └──────────────────┘ └──────┬───────┘ └─────────────────┘
                               │
                    ┌──────────┼──────────┐
                    │                     │
           ┌───────▼────────┐  ┌─────────▼───────┐
           │ Team D: Voice  │  │ Team E: AI      │
           │ (音声処理)      │  │ (AI連携)         │
           └────────────────┘  └─────────────────┘
```

---

## Phase 0: 基盤構築（全チーム着手前の前提）

### Team A: Foundation

- [ ] **A-1** Tauriプロジェクト初期化（`create-tauri-app`）
- [ ] **A-2** Vite + TypeScript + React 環境構築
  - `package.json`, `tsconfig.json`, `vite.config.ts`
- [ ] **A-3** ディレクトリ構成の作成（仕様書の構成に準拠）
  - `src/`, `src-tauri/`, `config/`
- [ ] **A-4** 共有型定義の策定
  - `src/types/mode.ts` - Mode型、AIConfig型
  - `src/types/voice.ts` - TranscriptionResult型、AudioState型
  - `src/types/ai.ts` - AIResponse型、StreamChunk型
- [ ] **A-5** Tauri IPC インターフェース定義
  - フロントエンド⇔Rust間のコマンド名・引数・戻り値の型を確定
  - `invoke("transcribe_audio", { audioData })` 等
- [ ] **A-6** `config/modes.yaml` 初期設定ファイル作成
  - 3モード定義（raw, correct, summarize）
- [ ] **A-7** ESLint + Prettier + Rust fmt 設定
- [ ] **A-8** Git hooks（pre-commit: lint & format）

> **完了条件**: `pnpm dev` でTauri空ウィンドウが起動し、型定義が全チームに共有されていること

---

## Phase 1: 並列開発（Team B / C / D / E が同時進行）

### Team B: Frontend（UI コンポーネント）

**前提**: Team Aの型定義・プロジェクト構造が完了していること

- [ ] **B-1** `ModeSelector.tsx` - モード選択ラジオボタン
  - modes.yaml の設定を読み込んで動的に描画
  - 選択状態の管理（useState or 状態管理ライブラリ）
- [ ] **B-2** `TextArea.tsx` - テキスト入出力エリア
  - 入力テキスト（音声認識結果）と出力テキスト（AI処理後）の表示
  - リアルタイム更新対応（interim results表示）
- [ ] **B-3** `RecordButton.tsx` - 録音開始/停止ボタン
  - 録音状態に応じたUI切替（🎤 録音開始 / ■ 停止）
  - アニメーション（録音中のパルスエフェクト等）
- [ ] **B-4** `ActionButtons.tsx` - コピー・クリアボタン
  - クリップボードコピー（`navigator.clipboard.writeText`）
  - テキストエリアクリア
- [ ] **B-5** `App.tsx` レイアウト統合
  - 全コンポーネントの配置
  - 仕様書のUI構成図に準拠したレイアウト
- [ ] **B-6** スタイリング
  - macOSネイティブ風のデザイン
  - ダークモード対応（システム設定連動）
- [ ] **B-7** モックデータでの動作確認
  - Rust Backend未完成でもUI単体で操作確認可能にする
  - モック: 音声入力→固定テキスト表示、AI処理→遅延付き固定テキスト

> **完了条件**: モックデータで全UIコンポーネントが動作し、モード切替・テキスト表示・コピー・クリアが機能すること

---

### Team C: Rust Backend（Tauri コマンド基盤）

**前提**: Team AのTauriプロジェクト・IPC定義が完了していること

- [ ] **C-1** Tauriコマンドのスキャフォールディング
  - `src-tauri/src/commands/mod.rs` - コマンドモジュール構成
  - `src-tauri/src/commands/audio.rs` - 音声系コマンド（空実装）
  - `src-tauri/src/commands/ai.rs` - AI系コマンド（空実装）
- [ ] **C-2** 設定ファイル読み込み（`config/modes.yaml`）
  - `serde_yaml` で YAML パース
  - `src-tauri/src/config/modes.rs` - Mode構造体・デシリアライズ
  - Tauriコマンド `get_modes` で設定をフロントエンドに返す
- [ ] **C-3** 音声キャプチャ基盤
  - macOS AudioUnit / CoreAudio のRustバインディング設定
  - `cpal` クレートによるマイク入力ストリーム取得
  - 音声データのバッファリング（チャンク単位で処理できる構造）
- [ ] **C-4** ファイルシステム操作
  - 設定ファイルの読み書き
  - 一時音声ファイルの管理（保存・削除）
- [ ] **C-5** エラーハンドリング共通基盤
  - Tauriコマンドのエラー型定義
  - フロントエンドへのエラー伝搬パターン確立

> **完了条件**: `invoke("get_modes")` でYAML設定が返り、マイクからの音声データ取得が動作すること

---

### Team D: Voice Processing（音声認識）

**前提**: Team Cの音声キャプチャ基盤（C-3）が完了していること
**並列作業可能**: API クライアント部分はTeam Cと並行開発可能

- [ ] **D-1** 音声フォーマット処理
  - PCM → WAV 変換ユーティリティ
  - サンプリングレート・チャンネル数の正規化（Whisper要求仕様に合わせる）
- [ ] **D-2** Whisper API クライアント実装（Rust）
  - OpenAI Whisper API への音声データ送信
  - レスポンスパース（テキスト + 信頼度スコア）
  - API Key 管理（環境変数 or 設定ファイル）
- [ ] **D-3** リアルタイム文字起こしパイプライン
  - 音声ストリーム → チャンク分割 → 逐次API呼出 → テキスト結合
  - interim results（暫定結果）のフロントエンドへの逐次送信
- [ ] **D-4** whisper.cpp ローカル実行対応（オプション）
  - `whisper-rs` クレートの導入
  - モデルファイルのダウンロード・管理
  - ローカル推論パイプライン
- [ ] **D-5** 音声認識エンジン切替機構
  - Whisper API / whisper.cpp / 将来のmacOS native を切替可能なtrait設計
  - 設定ファイルでエンジン選択

> **完了条件**: マイク入力 → Whisper API → 日本語テキストが返るE2Eパイプラインが動作すること

---

### Team E: AI Integration（AI 処理）

**前提**: Team AのIPC定義が完了していること
**並列作業可能**: AI APIクライアントは独立して開発可能

- [ ] **E-1** AI API クライアント実装（Rust or TypeScript）
  - OpenAI GPT-4o-mini クライアント
  - Claude Haiku クライアント（代替）
  - API Key管理
- [ ] **E-2** ストリーミングレスポンス対応
  - SSE (Server-Sent Events) パース
  - チャンク毎のフロントエンド送信
  - Tauriイベントシステムでのストリーム配信
- [ ] **E-3** プロンプトテンプレートエンジン
  - modes.yaml の `ai_prompt` を読み込み
  - 変数展開（`{input}`, `{context}` 等のプレースホルダー）
  - プロンプト組み立てロジック
- [ ] **E-4** コンテキスト管理
  - 直近N件（デフォルト3件）の入力履歴保持
  - コンテキスト付きプロンプト生成
  - セッション管理（コンテキストのリセット等）
- [ ] **E-5** フォールバック戦略実装
  - API呼出失敗時 → 生テキスト表示 + エラー通知
  - タイムアウト設定（デフォルト10秒）
  - リトライロジック（exponential backoff）
- [ ] **E-6** AI プロバイダー切替機構
  - OpenAI / Anthropic / ローカルLLM を切替可能な抽象化
  - 設定ファイルでプロバイダー選択

> **完了条件**: テキスト入力 → AI API → ストリーミングで加工済みテキストが返るパイプラインが動作すること

---

## Phase 2: 統合（全チーム合流）

- [ ] **INT-1** フロントエンド ⇔ Rust Backend 接続
  - Team B のUI + Team C のTauriコマンドを接続
  - モック除去、実データに切替
- [ ] **INT-2** 音声入力 → テキスト表示のE2E統合
  - RecordButton → Team D の音声パイプライン → TextArea表示
- [ ] **INT-3** テキスト → AI処理 → 出力のE2E統合
  - モード選択 → Team E のAIパイプライン → ストリーミング表示
- [ ] **INT-4** 全体フロー統合テスト
  - 🎤 → 音声認識 → モード別AI処理 → テキスト出力 → コピー
- [ ] **INT-5** エラーハンドリング統合
  - 音声認識失敗 / AI API失敗 / ネットワーク切断 等のケース

> **完了条件**: 音声入力からAI処理済みテキスト出力まで、全モードで正常動作すること

---

## Phase 3: 品質向上・カスタマイズ

- [ ] **QA-1** パフォーマンス最適化
  - 音声認識のレイテンシ計測・改善
  - AI応答時間の計測・改善
- [ ] **QA-2** UIブラッシュアップ
  - アニメーション、トランジション
  - アクセシビリティ対応
- [ ] **QA-3** モード設定のUI化（Phase 4相当）
  - 設定画面の追加
  - カスタムプロンプト編集UI
- [ ] **QA-4** キーボードショートカット対応
  - 録音開始/停止のグローバルショートカット
  - モード切替のショートカット
- [ ] **QA-5** アプリアイコン・メニューバー対応
  - macOS メニューバーアプリとしての動作（オプション）

---

## 依存関係マトリクス

| タスク | 依存先 | 並列可能 |
|--------|--------|----------|
| Team A (A-1〜A-8) | なし | - |
| Team B (B-1〜B-7) | A-3, A-4 | B内は全て並列可 |
| Team C (C-1〜C-5) | A-1, A-5 | C-1,C-2は並列可、C-3以降は順次 |
| Team D (D-1〜D-5) | C-3 | D-1,D-2はC-3完了前に着手可 |
| Team E (E-1〜E-6) | A-5 | E内は全て並列可 |
| 統合 (INT-1〜INT-5) | B,C,D,E 全完了 | INT-1→INT-2→INT-3は順次 |

## タイムライン目安

```
Week 1:     [====Team A====]
Week 2-3:   [===Team B===] [===Team C===] [===Team E===]
Week 3-4:                  [===Team D===]
Week 5:     [========= 統合 (INT) =========]
Week 6:     [======= 品質向上 (QA) ========]
```
